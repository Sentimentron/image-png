// Microbenchmark for all the various filters

use png::benchable_apis::unfilter;
use png::Filter;
use std::hint::black_box;

const CURRENT_ROW: [u8; 771] = [
    30, 134, 150, 121, 53, 45, 57, 186, 248, 150, 4, 5, 212, 192, 104, 161, 238, 94, 32, 89, 199,
    60, 124, 15, 47, 235, 129, 214, 115, 207, 129, 134, 169, 6, 105, 90, 43, 36, 162, 78, 85, 13,
    120, 7, 172, 15, 83, 35, 134, 50, 26, 252, 107, 64, 72, 120, 218, 72, 100, 31, 98, 2, 165, 155,
    151, 124, 139, 234, 17, 181, 25, 241, 170, 251, 146, 191, 240, 189, 18, 49, 138, 105, 157, 246,
    247, 32, 35, 42, 98, 209, 105, 237, 61, 93, 213, 252, 242, 41, 202, 126, 185, 170, 129, 233,
    57, 217, 185, 39, 33, 14, 216, 139, 19, 193, 211, 254, 98, 47, 207, 222, 131, 255, 153, 213,
    76, 21, 12, 145, 130, 98, 124, 79, 138, 91, 41, 111, 232, 191, 16, 46, 93, 192, 6, 71, 47, 235,
    162, 190, 229, 135, 180, 237, 157, 254, 221, 42, 69, 218, 40, 153, 89, 165, 90, 219, 29, 223,
    57, 220, 188, 195, 252, 158, 160, 21, 38, 109, 39, 148, 141, 57, 162, 142, 59, 16, 130, 2, 206,
    166, 82, 98, 129, 150, 88, 44, 95, 111, 2, 3, 1, 192, 77, 179, 112, 43, 119, 158, 2, 84, 152,
    28, 48, 189, 200, 214, 34, 198, 166, 237, 73, 215, 131, 104, 89, 32, 26, 30, 221, 143, 59, 101,
    56, 232, 248, 1, 153, 106, 59, 161, 242, 204, 30, 184, 46, 100, 149, 247, 115, 130, 52, 101,
    189, 94, 180, 214, 52, 12, 114, 247, 178, 193, 123, 12, 175, 39, 200, 228, 213, 92, 227, 225,
    184, 64, 69, 238, 244, 2, 26, 19, 62, 71, 45, 129, 104, 107, 162, 47, 44, 66, 217, 19, 216, 46,
    188, 77, 253, 153, 51, 131, 202, 126, 44, 103, 213, 151, 238, 24, 132, 188, 41, 226, 27, 194,
    100, 169, 179, 184, 103, 60, 150, 229, 188, 17, 38, 46, 8, 56, 246, 161, 236, 211, 226, 173,
    175, 52, 44, 115, 152, 53, 103, 35, 3, 164, 76, 150, 100, 50, 57, 57, 142, 51, 85, 110, 50,
    198, 83, 179, 116, 253, 50, 98, 126, 152, 119, 157, 174, 124, 118, 96, 128, 75, 253, 152, 75,
    41, 89, 244, 88, 122, 98, 105, 174, 36, 226, 118, 235, 112, 134, 233, 229, 115, 182, 215, 123,
    231, 148, 98, 74, 126, 225, 18, 157, 36, 47, 119, 232, 186, 32, 244, 11, 4, 0, 103, 238, 209,
    50, 92, 53, 140, 208, 225, 209, 51, 129, 3, 152, 81, 166, 13, 75, 163, 78, 201, 199, 96, 123,
    23, 141, 240, 49, 72, 179, 203, 64, 147, 123, 215, 135, 211, 59, 237, 174, 42, 80, 198, 156,
    27, 218, 6, 104, 1, 30, 78, 92, 146, 195, 123, 6, 112, 199, 51, 204, 137, 63, 197, 5, 253, 121,
    28, 22, 34, 226, 180, 191, 239, 65, 131, 7, 61, 168, 104, 238, 220, 130, 216, 111, 137, 83, 17,
    174, 113, 226, 75, 210, 56, 130, 159, 36, 168, 62, 48, 8, 198, 9, 80, 83, 62, 132, 182, 24,
    160, 107, 56, 151, 12, 10, 43, 178, 93, 50, 146, 130, 80, 62, 36, 187, 234, 116, 132, 83, 133,
    19, 102, 118, 114, 190, 247, 62, 27, 164, 118, 194, 243, 7, 116, 222, 140, 82, 102, 14, 7, 9,
    149, 132, 21, 35, 73, 87, 75, 116, 122, 159, 154, 88, 151, 155, 69, 106, 79, 196, 214, 255, 23,
    248, 172, 208, 220, 127, 230, 116, 24, 84, 21, 238, 164, 127, 78, 113, 56, 25, 73, 169, 85,
    228, 186, 24, 240, 175, 36, 171, 138, 155, 173, 127, 236, 193, 245, 105, 236, 35, 29, 164, 241,
    27, 145, 16, 83, 143, 93, 36, 16, 222, 103, 248, 37, 254, 16, 83, 96, 64, 102, 9, 37, 180, 158,
    220, 159, 82, 102, 222, 234, 220, 68, 77, 94, 129, 250, 26, 183, 98, 50, 228, 202, 135, 243,
    206, 152, 33, 196, 5, 33, 224, 20, 64, 2, 129, 167, 209, 141, 148, 89, 242, 236, 128, 235, 168,
    67, 130, 16, 171, 238, 193, 93, 116, 134, 63, 120, 156, 34, 197, 127, 160, 61, 247, 215, 215,
    60, 87, 148, 17, 253, 244, 231, 78, 120, 105, 164, 20, 147, 71, 69, 216, 142, 119, 16, 151,
    244, 96, 99, 240, 107, 225, 101, 255, 121, 92, 181, 167, 188, 78, 236, 127, 0, 217, 102, 32,
    238, 93, 90, 234, 210, 227, 122, 149, 178, 90, 224, 51, 231, 171, 203, 160, 13, 210, 153, 220,
    253, 211, 226, 221, 232, 59,
];
const PREV_ROW: [u8; 771] = [
    139, 205, 243, 195, 198, 178, 92, 120, 93, 222, 173, 91, 80, 193, 6, 149, 199, 190, 229, 64,
    181, 157, 183, 99, 141, 175, 100, 150, 44, 221, 220, 195, 59, 31, 155, 196, 220, 72, 101, 107,
    71, 121, 39, 171, 235, 155, 46, 58, 182, 98, 73, 253, 110, 71, 226, 86, 176, 202, 141, 225,
    230, 117, 220, 117, 196, 24, 211, 46, 200, 106, 156, 39, 47, 246, 230, 199, 169, 25, 235, 236,
    42, 175, 163, 23, 132, 249, 83, 162, 148, 87, 145, 107, 197, 218, 10, 134, 11, 11, 148, 101,
    201, 234, 233, 53, 217, 198, 69, 140, 21, 111, 43, 181, 104, 176, 60, 49, 116, 15, 166, 53,
    187, 190, 170, 230, 240, 134, 124, 61, 146, 36, 203, 131, 6, 192, 122, 230, 247, 4, 140, 1, 92,
    68, 4, 225, 217, 27, 148, 48, 102, 48, 67, 195, 27, 152, 253, 48, 205, 140, 215, 146, 242, 233,
    45, 123, 40, 86, 204, 120, 128, 59, 79, 213, 219, 250, 30, 70, 65, 139, 11, 56, 35, 77, 113,
    60, 98, 100, 124, 16, 57, 34, 144, 237, 108, 160, 203, 222, 48, 99, 241, 253, 232, 115, 73,
    216, 208, 224, 217, 139, 64, 77, 176, 108, 70, 155, 132, 169, 7, 80, 125, 240, 209, 163, 16,
    109, 122, 165, 19, 224, 61, 79, 128, 166, 245, 99, 205, 189, 243, 44, 252, 145, 54, 127, 194,
    80, 97, 248, 206, 250, 26, 0, 71, 139, 224, 77, 142, 77, 225, 143, 196, 196, 10, 195, 45, 144,
    194, 76, 110, 206, 115, 14, 204, 129, 101, 249, 196, 206, 15, 159, 50, 3, 179, 150, 109, 238,
    188, 5, 165, 72, 11, 123, 23, 94, 154, 31, 76, 33, 74, 20, 106, 224, 231, 219, 104, 84, 226,
    112, 29, 167, 190, 31, 252, 58, 166, 171, 126, 220, 74, 125, 74, 233, 242, 64, 41, 209, 205,
    239, 222, 104, 2, 159, 66, 219, 21, 51, 212, 166, 153, 34, 136, 130, 12, 148, 182, 13, 55, 84,
    227, 158, 39, 61, 201, 132, 61, 17, 180, 202, 159, 102, 167, 18, 138, 35, 144, 6, 58, 66, 136,
    126, 212, 122, 66, 172, 148, 236, 138, 252, 128, 190, 55, 152, 109, 44, 70, 89, 8, 196, 186,
    110, 54, 62, 243, 89, 129, 224, 155, 179, 107, 25, 3, 125, 253, 143, 233, 183, 204, 64, 112,
    92, 65, 201, 61, 215, 80, 14, 229, 105, 244, 254, 180, 31, 92, 17, 115, 97, 252, 244, 243, 131,
    64, 202, 244, 184, 16, 82, 219, 58, 205, 72, 233, 17, 113, 53, 26, 220, 197, 26, 165, 120, 142,
    72, 228, 119, 50, 108, 170, 125, 212, 1, 129, 59, 210, 84, 21, 66, 232, 180, 177, 202, 127, 40,
    47, 0, 94, 148, 68, 22, 138, 160, 143, 195, 211, 62, 93, 245, 186, 215, 32, 104, 17, 24, 5,
    143, 224, 74, 122, 172, 183, 82, 141, 113, 88, 194, 115, 200, 55, 24, 249, 13, 30, 249, 165,
    112, 38, 159, 52, 46, 107, 176, 55, 157, 40, 199, 146, 116, 42, 226, 166, 193, 121, 105, 30,
    98, 87, 47, 182, 67, 152, 217, 25, 226, 158, 52, 103, 67, 32, 143, 17, 60, 68, 1, 188, 253,
    255, 51, 164, 90, 246, 212, 114, 221, 165, 241, 96, 15, 134, 231, 44, 117, 84, 172, 119, 198,
    168, 32, 153, 171, 10, 252, 97, 233, 123, 186, 151, 225, 97, 92, 135, 128, 241, 181, 14, 202,
    230, 206, 15, 250, 139, 21, 141, 21, 135, 96, 17, 46, 8, 221, 155, 171, 128, 70, 225, 239, 19,
    88, 193, 44, 222, 14, 53, 142, 96, 60, 150, 238, 159, 236, 222, 205, 162, 241, 247, 61, 205,
    56, 124, 162, 133, 78, 202, 177, 86, 132, 142, 40, 238, 162, 169, 137, 88, 120, 107, 126, 237,
    139, 111, 95, 25, 210, 2, 24, 120, 189, 77, 181, 54, 129, 55, 58, 214, 84, 124, 106, 158, 184,
    135, 140, 158, 84, 109, 127, 159, 230, 254, 45, 66, 69, 44, 94, 165, 250, 15, 229, 174, 77,
    238, 70, 207, 224, 229, 97, 146, 9, 204, 114, 28, 137, 141, 90, 129, 106, 223, 94, 228, 248,
    158, 229, 178, 174, 149, 15, 62, 94, 103, 223, 237, 130, 192, 180, 0, 229, 119, 188, 20, 191,
    193, 107, 184, 136, 201, 181, 96, 38, 54, 25, 200, 95, 143, 224, 42, 116, 217, 96, 44, 243,
    168, 212, 150, 135, 18, 147, 235, 110, 251, 165, 75, 185, 96, 21, 126, 155, 191,
];

fn main() {
    let bpps: [u8; 1] = [3];
    let filters: [Filter; 1] = [
        //Filter::Sub
        //Filter::Up,
        //Filter::Avg,
        Filter::Paeth,
    ];

    for _ in 0..64 {
        for &filter in filters.iter() {
            for &bpp in bpps.iter() {
                let mut curr_row: Vec<u8> = CURRENT_ROW.to_vec();
                black_box(unfilter(filter, bpp, &PREV_ROW, curr_row.as_mut_slice()))
            }
        }
    }
}
